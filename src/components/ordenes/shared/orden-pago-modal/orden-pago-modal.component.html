<div class="modal-container">
  <div class="modal-header">
    <h2>
      <mat-icon>payment</mat-icon>
      Registrar Pago
    </h2>
    <button mat-icon-button (click)="cerrar()" [disabled]="guardando">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="modal-body">
    <!-- Información de saldo -->
    <div class="saldo-info">
      <mat-icon>account_balance_wallet</mat-icon>
      <div class="saldo-content">
        <span class="saldo-label">Saldo Pendiente</span>
        <span class="saldo-value">S/ {{ data.saldoPendiente | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Error -->
    <div *ngIf="error" class="alert alert-error">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <!-- Formulario -->
    <form [formGroup]="pagoForm" (ngSubmit)="registrarPago()">
      
      <!-- Monto -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Monto a Pagar</mat-label>
        <input matInput 
               type="number" 
               formControlName="monto"
               placeholder="0.00"
               step="0.01">
        <span matPrefix>S/&nbsp;</span>
        <mat-icon matSuffix>attach_money</mat-icon>
        <mat-error *ngIf="pagoForm.get('monto')?.hasError('required')">
          El monto es requerido
        </mat-error>
        <mat-error *ngIf="pagoForm.get('monto')?.hasError('min')">
          El monto debe ser mayor a 0
        </mat-error>
        <mat-error *ngIf="pagoForm.get('monto')?.hasError('max')">
          El monto no puede exceder el saldo pendiente
        </mat-error>
      </mat-form-field>

      <!-- Tipo de Pago -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Tipo de Pago</mat-label>
        <mat-select formControlName="idTipoPago" (selectionChange)="onTipoPagoChange()">
          <mat-option *ngFor="let tipo of tiposPago" [value]="tipo.idTipoPago">
            {{ tipo.nombre }}
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>payment</mat-icon>
        <mat-error>Selecciona un tipo de pago</mat-error>
      </mat-form-field>

      <!-- Número de Operación -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Número de Operación</mat-label>
        <input matInput formControlName="numeroOperacion" placeholder="Opcional">
        <mat-icon matPrefix>confirmation_number</mat-icon>
        <mat-error>El número de operación es requerido para este tipo de pago</mat-error>
      </mat-form-field>

      <!-- Observaciones -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Observaciones</mat-label>
        <textarea matInput 
                  formControlName="observaciones"
                  rows="3"
                  placeholder="Observaciones adicionales (opcional)"></textarea>
        <mat-icon matPrefix>note</mat-icon>
      </mat-form-field>

    </form>
  </div>

  <div class="modal-actions">
    <button mat-button (click)="cerrar()" [disabled]="guardando">
      Cancelar
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="registrarPago()"
            [disabled]="pagoForm.invalid || guardando">
      <mat-spinner *ngIf="guardando" diameter="20"></mat-spinner>
      <span *ngIf="!guardando">Registrar Pago</span>
    </button>
  </div>
</div>