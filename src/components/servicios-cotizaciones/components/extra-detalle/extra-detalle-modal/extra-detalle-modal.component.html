<div class="modal-overlay" (click)="cancelar()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2>{{ editando ? 'Editar Detalle de Precio' : 'Agregar Detalle de Precio' }}</h2>
      <button class="btn-close" (click)="cancelar()">×</button>
    </div>

    <!-- Body -->
    <div class="modal-body">
      <!-- Mensaje de error -->
      <div *ngIf="error" class="alert alert-error">
        {{ error }}
      </div>

      <!-- Loading -->
      <div *ngIf="cargando" class="loading">
        <div class="spinner"></div>
        <p>Procesando...</p>
      </div>

      <!-- Formulario -->
      <form [formGroup]="detalleForm" (ngSubmit)="onSubmit()" *ngIf="!cargando">
        
        <!-- Precio Base -->
        <div class="form-group">
          <label for="precioExtraBase">Precio Base del Extra *</label>
          <div class="input-with-prefix">
            <span class="input-prefix">$</span>
            <input 
              type="number" 
              id="precioExtraBase"
              formControlName="precioExtraBase"
              class="form-control with-prefix"
              placeholder="Ej: 50.00"
              step="0.01"
              min="0.01"
              [class.is-invalid]="detalleForm.get('precioExtraBase')?.invalid && detalleForm.get('precioExtraBase')?.touched">
          </div>
          <div *ngIf="detalleForm.get('precioExtraBase')?.invalid && detalleForm.get('precioExtraBase')?.touched" class="error-message">
            <span *ngIf="detalleForm.get('precioExtraBase')?.hasError('required')">Campo requerido</span>
            <span *ngIf="detalleForm.get('precioExtraBase')?.hasError('min')">Debe ser mayor a 0</span>
          </div>
        </div>

        <!-- Unidad de Medida -->
        <div class="form-group">
          <label for="unidadBaseExtra">Unidad de Medida *</label>
          <select 
            id="unidadBaseExtra"
            formControlName="unidadBaseExtra"
            class="form-control">
            <option value="unidad">Unidad</option>
            <option value="pieza">Pieza</option>
            <option value="hoja">Hoja</option>
            <option value="metro">Metro</option>
            <option value="m2">Metro cuadrado</option>
            <option value="servicio">Servicio completo</option>
          </select>
        </div>

        <!-- Rango de Cantidad (opcional) -->
        <div class="form-group">
          <label>Rango de Cantidad (Opcional)</label>
          <small class="form-hint">Deja vacío si el precio aplica a cualquier cantidad</small>
          
          <div class="form-row">
            <div class="form-group">
              <label for="cantidadMin">Cantidad Mínima</label>
              <input 
                type="number" 
                id="cantidadMin"
                formControlName="cantidadMin"
                class="form-control"
                placeholder="Ej: 100"
                min="1">
            </div>

            <div class="form-group">
              <label for="cantidadMax">Cantidad Máxima</label>
              <input 
                type="number" 
                id="cantidadMax"
                formControlName="cantidadMax"
                class="form-control"
                placeholder="Ej: 500"
                min="1">
              <small class="form-hint">Dejar vacío = sin límite superior</small>
            </div>
          </div>
        </div>

        <!-- Preview -->
        <div *ngIf="detalleForm.get('precioExtraBase')?.valid" class="precio-preview">
          <strong>Vista previa:</strong>
          <p>
            ${{ detalleForm.get('precioExtraBase')?.value }} 
            por {{ detalleForm.get('unidadBaseExtra')?.value }}
            
            <span *ngIf="detalleForm.get('cantidadMin')?.value || detalleForm.get('cantidadMax')?.value">
              <br>
              <small>
                Aplicable de 
                {{ detalleForm.get('cantidadMin')?.value || '0' }}
                a
                {{ detalleForm.get('cantidadMax')?.value || '∞' }}
                unidades
              </small>
            </span>
          </p>
        </div>

      </form>
    </div>

    <!-- Footer -->
    <div class="modal-footer" *ngIf="!cargando">
      <button class="btn btn-secondary" (click)="cancelar()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="onSubmit()" 
              [disabled]="detalleForm.invalid || cargando">
        {{ editando ? 'Actualizar' : 'Crear' }}
      </button>
    </div>
  </div>
</div>