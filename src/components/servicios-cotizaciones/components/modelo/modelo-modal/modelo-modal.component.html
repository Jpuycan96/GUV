<div class="modal-overlay" (click)="cancelar()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2>{{ editando ? 'Editar Modelo' : 'Crear Nuevo Modelo' }}</h2>
      <button class="btn-close" (click)="cancelar()">×</button>
    </div>

    <!-- Body -->
    <div class="modal-body">
      <!-- Mensaje de error -->
      <div *ngIf="error" class="alert alert-error">
        {{ error }}
      </div>

      <!-- Loading -->
      <div *ngIf="cargando" class="loading">
        <div class="spinner"></div>
        <p>Procesando...</p>
      </div>

      <!-- Formulario -->
      <form [formGroup]="modeloForm" (ngSubmit)="onSubmit()" *ngIf="!cargando">
        
        <!-- Campo Material -->
        <div class="form-group">
          <label for="idMaterial">Material *</label>
          <select 
            id="idMaterial"
            formControlName="idMaterial"
            class="form-control"
            [class.is-invalid]="modeloForm.get('idMaterial')?.invalid && modeloForm.get('idMaterial')?.touched">
            <option value="">-- Selecciona un material --</option>
            <option *ngFor="let material of materiales" [value]="material.idMaterial">
              {{ material.nombre }}
            </option>
          </select>
          <div *ngIf="modeloForm.get('idMaterial')?.invalid && modeloForm.get('idMaterial')?.touched" class="error-message">
            <span *ngIf="modeloForm.get('idMaterial')?.hasError('required')">Debe seleccionar un material</span>
          </div>
        </div>

        <!-- Campo Código -->
        <div class="form-group">
          <label for="codigo">Código del Modelo *</label>
          <input 
            type="text" 
            id="codigo"
            formControlName="codigo"
            class="form-control"
            placeholder="Ej: MOD001"
            [class.is-invalid]="modeloForm.get('codigo')?.invalid && modeloForm.get('codigo')?.touched">
          <div *ngIf="modeloForm.get('codigo')?.invalid && modeloForm.get('codigo')?.touched" class="error-message">
            <span *ngIf="modeloForm.get('codigo')?.hasError('required')">El código es requerido</span>
            <span *ngIf="modeloForm.get('codigo')?.hasError('minlength')">Mínimo 2 caracteres</span>
            <span *ngIf="modeloForm.get('codigo')?.hasError('maxlength')">Máximo 25 caracteres</span>
          </div>
        </div>

        <!-- Campo Descripción -->
        <div class="form-group">
          <label for="descripcion">Descripción</label>
          <textarea 
            id="descripcion"
            formControlName="descripcion"
            class="form-control"
            rows="3"
            placeholder="Describe las características del modelo"
            [class.is-invalid]="modeloForm.get('descripcion')?.invalid && modeloForm.get('descripcion')?.touched">
          </textarea>
          <div *ngIf="modeloForm.get('descripcion')?.invalid && modeloForm.get('descripcion')?.touched" class="error-message">
            <span *ngIf="modeloForm.get('descripcion')?.hasError('maxlength')">Máximo 255 caracteres</span>
          </div>
        </div>

        <!-- Campo Activo -->
        <div class="form-group checkbox-group">
          <label for="activo">
            <input 
              type="checkbox" 
              id="activo"
              formControlName="activo"
              class="checkbox-control">
            Modelo activo
          </label>
        </div>
      </form>
    </div>

    <!-- Footer -->
    <div class="modal-footer" *ngIf="!cargando">
      <button class="btn btn-secondary" (click)="cancelar()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="onSubmit()" 
              [disabled]="modeloForm.invalid || cargando">
        {{ editando ? 'Actualizar' : 'Crear' }}
      </button>
    </div>
  </div>
</div>